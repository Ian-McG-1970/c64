; map of 32x32 tiles converted to 128x128 chars
; eah tiles is either wall (neg) or floor (pos)
; each floor tiles has a 4 bit point pointing to which direction objects can move in on this tile? (4 bits for up/down/left/right)

; next is to convert 32x32 tiles into 128x128 chars

; screen = 18k to 19k
; charset = 16k to 18k
; sprites = 19k to 32k

*= 2049
!byte $0c,$08,$0a,$00,$9e   ; Line 10 SYS
!tx "2070"            ; Address for sys start in text 4096+11

SCR = 2
MEM_FROM = SCR +2
MEM_TO = MEM_FROM +2

REGA = MEM_TO +2
REGX = REGA +1
REGY = REGX +1

PLAYER_V_HI = REGY +1
PLAYER_V_LO = PLAYER_V_HI +1
PLAYER_H_HI = PLAYER_V_LO +1
PLAYER_H_LO = PLAYER_H_HI +1

SPR2_V_LO = PLAYER_H_LO +1 
SPR2_V_HI = SPR2_V_LO +1
SPR2_H_LO = SPR2_V_HI +1
SPR2_H_HI = SPR2_H_LO +1

SPR3_V_LO = SPR2_H_HI +1
SPR3_V_HI = SPR3_V_LO +1
SPR3_H_LO = SPR3_V_HI +1
SPR3_H_HI = SPR3_H_LO +1

SPR4_V_LO = SPR3_H_HI +1
SPR4_V_HI = SPR4_V_LO +1
SPR4_H_LO = SPR4_V_HI +1
SPR4_H_HI = SPR4_H_LO +1

SPR5_V_LO = SPR4_H_HI +1
SPR5_V_HI = SPR5_V_LO +1
SPR5_H_LO = SPR5_V_HI +1
SPR5_H_HI = SPR5_H_LO +1

SPR6_V_LO = SPR5_H_HI +1
SPR6_V_HI = SPR6_V_LO +1
SPR6_H_LO = SPR6_V_HI +1
SPR6_H_HI = SPR6_H_LO +1

SPR7_V_LO = SPR6_H_HI +1
SPR7_V_HI = SPR7_V_LO +1
SPR7_H_LO = SPR7_V_HI +1
SPR7_H_HI = SPR7_H_LO +1

SPR2V = SPR7_H_HI +1
SPR2H = SPR2V +1
SPR2S = SPR2H +1 ; shape
SPR2C = SPR2S +1 ; colour

SPR3V = SPR2C +1
SPR3H = SPR3V +1
SPR3S = SPR3H +1
SPR3C = SPR3S +1

SPR4V = SPR3C +1
SPR4H = SPR4V +1
SPR4S = SPR4H +1
SPR4C = SPR4S +1

SPR5V = SPR4C +1
SPR5H = SPR5V +1
SPR5S = SPR5H +1
SPR5C = SPR5S +1

SPR6V = SPR5C +1
SPR6H = SPR6V +1
SPR6S = SPR6H +1
SPR6C = SPR6S +1

SPR7V = SPR6C +1
SPR7H = SPR7V +1
SPR7S = SPR7H +1
SPR7C = SPR7S +1

BDR = $D020
SCR0 = $D021
SCR1 = $D022
SCR2 = $D023
SCR3 = $D024
SPC1 = $D025
SPC2 = $D026

MULCOLSPR = $D01C

SPRENBL = 53248+21
SPRXPX = 53248+29 
SPRXPY = 53248+23

S0X = 53248+0
S0Y = 53248+1
S0C = $D027
S0P = VIC_SCN+$03f8
HW_SPRITE_0 = (512/64)+0

S1X = 53248+2
S1Y = 53248+3
S1C = $D028
S1P = VIC_SCN+$03f9
HW_SPRITE_1 = (512/64)+1

S2X = 53248+4
S2Y = 53248+5
S2C = $D029
S2P = VIC_SCN+$03fa
HW_SPRITE_2 = (512/64)+2

S3X = 53248+6
S3Y = 53248+7
S3C = $D02A
S3P = VIC_SCN+$03fb
HW_SPRITE_3 = (512/64)+3

S4X = 53248+8
S4Y = 53248+9
S4C = $D02B
S4P = VIC_SCN+$03fc
HW_SPRITE_4 = (512/64)+4

S5X = 53248+10
S5Y = 53248+11
S5C = $D02C
S5P = VIC_SCN+$03fd
HW_SPRITE_5 = (512/64)+5

S6X = 53248+12
S6Y = 53248+13
S6C = $D02D
S6P = VIC_SCN+$03fe
HW_SPRITE_6 = (512/64)+6

S7X = 53248+14
S7Y = 53248+15
S7C = $D02E
S7P = VIC_SCN+$03ff
HW_SPRITE_7 = (512/64)+7

SPRXMSB = 53248+16

MP_RASTER_POS = 246-12
IRQ_042 = 84
IRQ_042 = 140

VIC_BANK = 16384
VIC_CHAR = VIC_BANK
VIC_SCN = VIC_CHAR +2048

VIC_BNK = %00000010 ; 16384

*= 2070

  SEI        ; disable maskable IRQs
  CLV
  CLD
  LDX   #$FF   ; reset stack
  TXS
 
  LDA   #$7F
  STA   $DC0D  ; disable timer interrupts which can be generated by the two CIA chips
  STA   $DD0D  ; the kernal uses such an interrupt to flash the cursor and scan the keyboard, so we better stop it.

  LDA   $DC0D  ; by reading this two registers we negate any pending CIA irqs.
  LDA   $DD0D  ; if we don't do this, a pending CIA irq might occur after we finish setting up our irq. we don't want that to happen.

  LDA   #$01   ; this is how to tell the VICII to generate a raster interrupt
  STA   $D01A

  LDA   #$10
  STA   $D011 ; #7: Read: Current raster line (bit #8) / #6: 1 = Extended background mode on / #5: 0 = Text mode; 1 = Bitmap mode / #4: 0 = Screen off, complete screen is covered by border; 1 = Screen on, normal screen contents are visible / #3: Screen height; 0 = 24 rows; 1 = 25 rows / #0-#2: Vertical raster scroll.
  LDA   #$10
  STA   $D016 ; #4: 1 = Multicolor mode on / #3: Screen width; 0 = 38 columns; 1 = 40 columns / #0-#2: Horizontal raster scroll.

  LDA   #$35   ; we turn off the BASIC and KERNAL rom here
  STA   $01    ; the cpu now sees RAM everywhere except at $d000-$e000, where still the registers of SID/VICII/etc are visible

  LDA   #<IRQ_10 ;IRQ_242  ; this is how we set up
  STA   $FFFE     ; the address of our interrupt code
  LDA   #>IRQ_10 ;IRQ_242
  STA   $FFFF
  LDA   #71 ; RASTER_242 ; this is how to tell at which rasterline we want the irq to be triggered
  STA   $D012
  
  LDA   #<NMI_NOP ; lsb
  STA   $FFFA ; Create a nop, irq handler for NMI that gets called whenever RESTORE is pressed or similar.
  LDA   #>NMI_NOP ; msb
  STA   $FFFB ; We're putting our irq handler directly in the vector that usually points to the kernal's NMI handler since we have kernal banked out.

  LDA   #$00  ; Force an NMI by setting up a timer. This will cause an NMI, that won't be acked. Any subsequent NMI's from RESTORE will be essentially disabled.
  STA   $DD0E       ; Stop timer A
  STA   $DD04       ; Set timer A to 0, NMI will occure immediately after start
  STA   $DD0E

  LDA   #$81
  STA   $DD0D       ; Set timer A as source for NMI

  LDA   #$01
  STA   $DD0E       ; Start timer A -> NMI

  LDA   #VIC_BNK
  STA   $DD00

  LDA   #%00100000 ; charset at 16*1024 / screen at 18*1024
  STA   $D018

  LDA   #0
  STA   BDR
  LDA   #1
  STA   SCR0
  LDA   #2
  STA   SCR1
  LDA   #3
  STA   SCR2

  LDA   #4
  STA   SPC1
  LDA   #5
  STA   SPC2

  LDA   #255
  STA   SPRENBL
  STA   MULCOLSPR

  LDA   #0
  STA   SPRXPX
  STA   SPRXPY

  LDA   #60
  STA   S0X
  STA   S0Y
 
  LDA   #70
  STA   S1X
  STA   S1Y

  LDA   #80
  STA   S2X
  STA   S2Y
  
  LDA   #90
  STA   S3X
  STA   S3Y

  LDA   #100
  STA   S4X
  STA   S4Y

  LDA   #110
  STA   S5X
  STA   S5Y

  LDA   #120
  STA   S6X
  STA   S6Y

  LDA   #130
  STA   S7X
  STA   S7Y

  LDA   #2
  STA   S0C
  LDA   #3
  STA   S1C
  LDA   #4
  STA   S2C
  LDA   #5
  STA   S3C
  LDA   #6
  STA   S4C
  LDA   #7
  STA   S5C
  LDA   #8
  STA   S6C
  LDA   #9
  STA   S7C

  
  LDA #HW_SPRITE_0
  STA S0P
  LDA #HW_SPRITE_1
  STA S1P

  LDA #$01
  LDX #<$D800
  LDY #>$D800
  STX SCR+0
  STY SCR+1
  LDX #>1000 
  LDY #<1000
;  JSR MEMSET

  LDX #<800
  LDY #>800
  STX MEM_FROM+0
  STY MEM_FROM+1
  LDX #<VIC_SCN
  LDY #>VIC_SCN
  STX MEM_TO+0
  STY MEM_TO+1
  LDY #<1024
  LDX #>1024
;  JSR MEMCPY

  LDX #<800
  LDY #>800
  STX MEM_FROM+0
  STY MEM_FROM+1
  LDX #<VIC_CHAR
  LDY #>VIC_CHAR
  STX MEM_TO+0
  STY MEM_TO+1
  LDY #<2048
  LDX #>2048
;  JSR MEMCPY

  CLI

MLOOP:  JMP   MLOOP ; we better don't RTS, the ROMS are now switched off, there's no way back to the system

;move memory down
;
; FROM = source start address
;   TO = destination start address
; SIZE = number of bytes to move
  
!ZONE MEMCPY
MEMCPY
    STY .LSB +1
    LDY #0
    TXA
    BEQ .LSB
.LOOPHI LDA (MEM_FROM),Y ; move a page at a time
        STA (MEM_TO),Y
        INY
        BNE .LOOPHI
      INC MEM_FROM+1
      INC MEM_TO+1
      DEX
      BNE .LOOPHI
.LSB    LDX #0
        BEQ .EXIT
.LOOPLO   LDA (MEM_FROM),Y ; move the remaining bytes
          STA (MEM_TO),Y
          INY
          DEX
          BNE .LOOPLO
.EXIT  RTS

!ZONE MEMSET        
MEMSET       STY    .LSB_ONLY+1 ; store LSB count
             CPX    #0          ; MSB?     
             BEQ    .LSB_ONLY   ; no

             LDY    #0          ; yes so reset LSB
.MSB_LOOP  
.LSB_LOOP      STA    (MEM_TO),Y   ; clear whole MSB
               DEY 
               BNE    .LSB_LOOP

              INC    MEM_TO+1      ; inc MSB
              DEX               ; dec MSB count
              BNE    .MSB_LOOP

.LSB_ONLY    LDY    #0          ; LSB count 
             BEQ    .MS_END     ; not needed

.LAST_LSB_LOOP STA   (MEM_TO),Y
               DEY 
               BNE   .LAST_LSB_LOOP
                
              STA   (MEM_TO),Y     ; clear last Y (0)
 
.MS_END      RTS
        
NMI_NOP: RTI ; This is the irq handler for the NMI. Just returns without acknowledge. This prevents subsequent NMI's from interfering.

SP000 = 48
SP001 = 49
SP002 = 50
SP003 = 51
SP004 = 52
SP005 = 53
SP006 = 54
SP007 = 55
SP008 = 56
SP009 = 57
SP010 = 58
SP011 = 59
SP012 = 60

!ZONE JOYSTICK
JOYSTICK1 LDA $DC01     ; PORT 1
          JMP .JOYSTICK
JOYSTICK2 LDA $DC00     ; PORT 2
.JOYSTICK LDX #0
          LDY #0
.UP       LSR
          BCS   .DOWN
            DEY
.DOWN     LSR
          BCS   .LEFT
            INY
.LEFT     LSR
          BCS   .RIGHT
            DEX
.RIGHT    LSR
          BCS   .FIRE
            INX
.FIRE     EOR   #255
          AND   #1
;          STA   JOYF
;          STX   JOYX
;          STY   JOYY
          LSR
          RTS

!ZONE MOVE_PLAYER
MOVE_PLAYER
    TXA
    BEQ   .VER
    BPL   .RIGHT
.LEFT   LDA   PLAYER_H_LO
    BNE   .L_TST
      DEC   PLAYER_H_HI
.L_TST  DEC   PLAYER_H_LO
    JMP   .VER
.RIGHT INC   PLAYER_H_LO
    BNE   .VER
      INC   PLAYER_H_HI
.VER    TYA
    BEQ   .EXIT
    BPL   .DOWN
.UP     LDA   PLAYER_V_LO
    BNE   .U_TST
      DEC   PLAYER_V_HI
.U_TST  DEC   PLAYER_V_LO
    RTS
.DOWN   INC   PLAYER_V_LO
    BNE   .EXIT
      INC   PLAYER_V_HI
.EXIT   RTS

!ZONE IRQ_SETUP_LO
!MACRO IRQ_SETUP_LO SPRITE_VER_POS, SPRITE_VER_POS_REG, SPRITE_SHAPE, SPRITE_SHAPE_REG, RASTER_POS, NEXT_IRQ_ADDR {
    STA .AREG +1      ;4 3
    LDA #SPRITE_VER_POS +2  ;2 3
    STA SPRITE_VER_POS_REG  ;4 2
    LDA #SPRITE_SHAPE   ;2 2
    STA SPRITE_SHAPE_REG  ;4 3
    LDA #RASTER_POS     ;2 2
    STA $D012           ;4 3
    LDA #<NEXT_IRQ_ADDR   ;2 2
    STA $FFFE       ;4 3
.AREG LDA #0        ;2 2
    INC $D019       ;6 3
;    RTI          ;6 
}

!ZONE IRQ_SETUP_HILO
!MACRO IRQ_SETUP_HILO SPRITE_VER_POS, SPRITE_VER_POS_REG, SPRITE_SHAPE, SPRITE_SHAPE_REG, RASTER_POS, NEXT_IRQ_ADDR {
    STA .AREG +1      ;4 3
    LDA #SPRITE_VER_POS +2  ;2 3
    STA SPRITE_VER_POS_REG  ;4 2
    LDA #SPRITE_SHAPE   ;2 2
    STA SPRITE_SHAPE_REG  ;4 3
    LDA #RASTER_POS     ;2 2
    STA $D012           ;4 3
    LDA #<NEXT_IRQ_ADDR   ;2 2
    STA $FFFE       ;4 3
    LDA #>NEXT_IRQ_ADDR   ;2 2
    STA $FFFF       ;4 3
.AREG LDA #0        ;2 2
    INC $D019       ;6 3
;    RTI          ;6 
}

!ZONE IRQ_SETUP
!MACRO IRQ_SETUP SPRITE_VER_POS, SPRITE_VER_POS_REG, SPRITE_SHAPE, SPRITE_SHAPE_REG, RASTER_POS, NEXT_IRQ_ADDR {
    STA .AREG +1      ;4 3
    LDA #SPRITE_VER_POS +2  ;2 3
    STA SPRITE_VER_POS_REG  ;4 2
    LDA #SPRITE_SHAPE   ;2 2
    STA SPRITE_SHAPE_REG  ;4 3
    LDA #RASTER_POS     ;2 2
    STA $D012           ;4 3
    LDA #<NEXT_IRQ_ADDR   ;2 2
    STA $FFFE       ;4 3
    LDA #>NEXT_IRQ_ADDR   ;2 2
    STA $FFFF       ;4 3
.AREG LDA #0        ;2 2
    INC $D019       ;6 3
;    RTI          ;6 
}

SP00_RASTER_IRQ = 34
SP01_RASTER_IRQ = SP00_RASTER_IRQ +3
SP02_RASTER_IRQ = SP01_RASTER_IRQ +3
SP03_RASTER_IRQ = SP02_RASTER_IRQ +3
SP04_RASTER_IRQ = SP03_RASTER_IRQ +3
SP05_RASTER_IRQ = SP04_RASTER_IRQ +3
SP06_RASTER_IRQ = SP05_RASTER_IRQ +3
;SP07_RASTER_IRQ = SP06_RASTER_IRQ +3

SP10_RASTER_IRQ = SP00_RASTER_IRQ +21
SP11_RASTER_IRQ = SP10_RASTER_IRQ +3
SP12_RASTER_IRQ = SP11_RASTER_IRQ +3
SP13_RASTER_IRQ = SP12_RASTER_IRQ +3
SP14_RASTER_IRQ = SP13_RASTER_IRQ +3
SP15_RASTER_IRQ = SP14_RASTER_IRQ +3
SP16_RASTER_IRQ = SP15_RASTER_IRQ +3
;SP17_RASTER_IRQ = SP16_RASTER_IRQ +3

SP20_RASTER_IRQ = SP10_RASTER_IRQ +21
SP21_RASTER_IRQ = SP20_RASTER_IRQ +3
SP22_RASTER_IRQ = SP21_RASTER_IRQ +3
SP23_RASTER_IRQ = SP22_RASTER_IRQ +3
SP24_RASTER_IRQ = SP23_RASTER_IRQ +3
SP25_RASTER_IRQ = SP24_RASTER_IRQ +3
SP26_RASTER_IRQ = SP25_RASTER_IRQ +3
;SP27_RASTER_IRQ = SP26_RASTER_IRQ +3

SP30_RASTER_IRQ = SP20_RASTER_IRQ +21
SP31_RASTER_IRQ = SP30_RASTER_IRQ +3
SP32_RASTER_IRQ = SP31_RASTER_IRQ +3
SP33_RASTER_IRQ = SP32_RASTER_IRQ +3
SP34_RASTER_IRQ = SP33_RASTER_IRQ +3
SP35_RASTER_IRQ = SP34_RASTER_IRQ +3
SP36_RASTER_IRQ = SP35_RASTER_IRQ +3
;SP37_RASTER_IRQ = SP36_RASTER_IRQ +3

SP40_RASTER_IRQ = SP30_RASTER_IRQ +21
SP41_RASTER_IRQ = SP40_RASTER_IRQ +3
SP42_RASTER_IRQ = SP41_RASTER_IRQ +3
SP43_RASTER_IRQ = SP42_RASTER_IRQ +3
SP44_RASTER_IRQ = SP43_RASTER_IRQ +3
SP45_RASTER_IRQ = SP44_RASTER_IRQ +3
SP46_RASTER_IRQ = SP45_RASTER_IRQ +3
;SP47_RASTER_IRQ = SP46_RASTER_IRQ +3

SP50_RASTER_IRQ = SP40_RASTER_IRQ +21
SP51_RASTER_IRQ = SP50_RASTER_IRQ +3
SP52_RASTER_IRQ = SP51_RASTER_IRQ +3
SP53_RASTER_IRQ = SP52_RASTER_IRQ +3
SP54_RASTER_IRQ = SP53_RASTER_IRQ +3
SP55_RASTER_IRQ = SP54_RASTER_IRQ +3
SP56_RASTER_IRQ = SP55_RASTER_IRQ +3
;SP57_RASTER_IRQ = SP56_RASTER_IRQ +3

SP60_RASTER_IRQ = SP50_RASTER_IRQ +21
SP61_RASTER_IRQ = SP60_RASTER_IRQ +3
SP62_RASTER_IRQ = SP61_RASTER_IRQ +3
SP63_RASTER_IRQ = SP62_RASTER_IRQ +3
SP64_RASTER_IRQ = SP63_RASTER_IRQ +3
SP65_RASTER_IRQ = SP64_RASTER_IRQ +3
SP66_RASTER_IRQ = SP65_RASTER_IRQ +3
;SP67_RASTER_IRQ = SP66_RASTER_IRQ +3

SP70_RASTER_IRQ = SP60_RASTER_IRQ +21
SP71_RASTER_IRQ = SP70_RASTER_IRQ +3
SP72_RASTER_IRQ = SP71_RASTER_IRQ +3
SP73_RASTER_IRQ = SP72_RASTER_IRQ +3
SP74_RASTER_IRQ = SP73_RASTER_IRQ +3
SP75_RASTER_IRQ = SP74_RASTER_IRQ +3
SP76_RASTER_IRQ = SP75_RASTER_IRQ +3
;SP77_RASTER_IRQ = SP76_RASTER_IRQ +3

SP80_RASTER_IRQ = SP70_RASTER_IRQ +21
SP81_RASTER_IRQ = SP80_RASTER_IRQ +3
SP82_RASTER_IRQ = SP81_RASTER_IRQ +3
SP83_RASTER_IRQ = SP82_RASTER_IRQ +3
SP84_RASTER_IRQ = SP83_RASTER_IRQ +3
SP85_RASTER_IRQ = SP84_RASTER_IRQ +3
SP86_RASTER_IRQ = SP85_RASTER_IRQ +3
;SP87_RASTER_IRQ = SP86_RASTER_IRQ +3

SP90_RASTER_IRQ = SP80_RASTER_IRQ +21
SP91_RASTER_IRQ = SP90_RASTER_IRQ +3
SP92_RASTER_IRQ = SP91_RASTER_IRQ +3
SP93_RASTER_IRQ = SP92_RASTER_IRQ +3
SP94_RASTER_IRQ = SP93_RASTER_IRQ +3
SP95_RASTER_IRQ = SP94_RASTER_IRQ +3
SP96_RASTER_IRQ = SP95_RASTER_IRQ +3
;SP97_RASTER_IRQ = SP96_RASTER_IRQ +3

!ALIGN 255,0
IRQ_00
  +IRQ_SETUP_LO SP00_RASTER_IRQ, S0Y, 48, S0P, SP01_RASTER_IRQ, IRQ_01
  RTI

IRQ_01
  +IRQ_SETUP_LO SP01_RASTER_IRQ, S1Y, 48, S1P, SP02_RASTER_IRQ, IRQ_02
  RTI

IRQ_02
  +IRQ_SETUP_LO SP02_RASTER_IRQ, S2Y, 48, S2P, SP03_RASTER_IRQ, IRQ_03
  RTI

IRQ_03
  +IRQ_SETUP_LO SP03_RASTER_IRQ, S3Y, 48, S3P, SP04_RASTER_IRQ, IRQ_04
  RTI

IRQ_04
  +IRQ_SETUP_LO SP04_RASTER_IRQ, S4Y, 48, S4P, SP05_RASTER_IRQ, IRQ_05
  RTI

IRQ_05
  +IRQ_SETUP_LO SP05_RASTER_IRQ, S5Y, 48, S5P, SP06_RASTER_IRQ, IRQ_06
  RTI

IRQ_06
  +IRQ_SETUP_HILO SP06_RASTER_IRQ, S6Y, 48, S6P, SP10_RASTER_IRQ, IRQ_10
  RTI

;IRQ_07
;  +IRQ_SETUP_HILO SP07_RASTER_IRQ, S7Y, 48, S7P, SP10_RASTER_IRQ, IRQ_10
;  RTI

!ALIGN 255,0
IRQ_10
  +IRQ_SETUP_LO SP10_RASTER_IRQ, S0Y, 51, S0P, SP11_RASTER_IRQ, IRQ_11
  RTI

IRQ_11
  +IRQ_SETUP_LO SP11_RASTER_IRQ, S1Y, 51, S1P, SP12_RASTER_IRQ, IRQ_12
  RTI

IRQ_12
  +IRQ_SETUP_LO SP12_RASTER_IRQ, S2Y, 51, S2P, SP13_RASTER_IRQ, IRQ_13
  RTI

IRQ_13
  +IRQ_SETUP_LO SP13_RASTER_IRQ, S3Y, 51, S3P, SP14_RASTER_IRQ, IRQ_14
  RTI

IRQ_14
  +IRQ_SETUP_LO SP14_RASTER_IRQ, S4Y, 51, S4P, SP15_RASTER_IRQ, IRQ_15
  RTI

IRQ_15
  +IRQ_SETUP_LO SP15_RASTER_IRQ, S5Y, 51, S5P, SP16_RASTER_IRQ, IRQ_16
  RTI

IRQ_16
  +IRQ_SETUP_HILO SP16_RASTER_IRQ, S6Y, 51, S6P, SP20_RASTER_IRQ, IRQ_20
  RTI

;IRQ_17
;  +IRQ_SETUP SP17_RASTER_IRQ, S7Y, 15, S7P, SP20_RASTER_IRQ, IRQ_20
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_20
  +IRQ_SETUP_LO SP20_RASTER_IRQ, S0Y, 54, S0P, SP21_RASTER_IRQ, IRQ_21
  RTI

IRQ_21
  +IRQ_SETUP_LO SP21_RASTER_IRQ, S1Y, 54, S1P, SP22_RASTER_IRQ, IRQ_22
  RTI

IRQ_22
  +IRQ_SETUP_LO SP22_RASTER_IRQ, S2Y, 54, S2P, SP23_RASTER_IRQ, IRQ_23
  RTI

IRQ_23
  +IRQ_SETUP_LO SP23_RASTER_IRQ, S3Y, 54, S3P, SP24_RASTER_IRQ, IRQ_24
  RTI

IRQ_24
  +IRQ_SETUP_LO SP24_RASTER_IRQ, S4Y, 54, S4P, SP25_RASTER_IRQ, IRQ_25
  RTI

IRQ_25
  +IRQ_SETUP_LO SP25_RASTER_IRQ, S5Y, 54, S5P, SP26_RASTER_IRQ, IRQ_26
  RTI

IRQ_26
  +IRQ_SETUP_HILO SP26_RASTER_IRQ, S6Y, 54, S6P, SP30_RASTER_IRQ, IRQ_30
  RTI

;IRQ_27
;  +IRQ_SETUP SP27_RASTER_IRQ, S7Y, 24, S7P, SP10_RASTER_IRQ, IRQ_10
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_30
  +IRQ_SETUP_LO SP30_RASTER_IRQ, S0Y, 48, S0P, SP31_RASTER_IRQ, IRQ_31
  RTI

IRQ_31
  +IRQ_SETUP_LO SP31_RASTER_IRQ, S1Y, 48, S1P, SP32_RASTER_IRQ, IRQ_32
  RTI

IRQ_32
  +IRQ_SETUP_LO SP32_RASTER_IRQ, S2Y, 48, S2P, SP33_RASTER_IRQ, IRQ_33
  RTI

IRQ_33
  +IRQ_SETUP_LO SP33_RASTER_IRQ, S3Y, 48, S3P, SP34_RASTER_IRQ, IRQ_34
  RTI

IRQ_34
  +IRQ_SETUP_LO SP34_RASTER_IRQ, S4Y, 48, S4P, SP35_RASTER_IRQ, IRQ_35
  RTI

IRQ_35
  +IRQ_SETUP_LO SP35_RASTER_IRQ, S5Y, 48, S5P, SP36_RASTER_IRQ, IRQ_36
  RTI

IRQ_36
  +IRQ_SETUP_HILO SP36_RASTER_IRQ, S6Y, 48, S6P, SP40_RASTER_IRQ, IRQ_40
  RTI

;IRQ_37
;  +IRQ_SETUP SP37_RASTER_IRQ, S7Y, 24, S7P, SP40_RASTER_IRQ, IRQ_40
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_40
  +IRQ_SETUP_LO SP40_RASTER_IRQ, S0Y, 51, S0P, SP41_RASTER_IRQ, IRQ_41
  RTI

IRQ_41
  +IRQ_SETUP_LO SP41_RASTER_IRQ, S1Y, 51, S1P, SP42_RASTER_IRQ, IRQ_42
  RTI

IRQ_42
  +IRQ_SETUP_LO SP42_RASTER_IRQ, S2Y, 51, S2P, SP43_RASTER_IRQ, IRQ_43
  RTI

IRQ_43
  +IRQ_SETUP_LO SP43_RASTER_IRQ, S3Y, 51, S3P, SP44_RASTER_IRQ, IRQ_44
  RTI

IRQ_44
  +IRQ_SETUP_LO SP44_RASTER_IRQ, S4Y, 51, S4P, SP45_RASTER_IRQ, IRQ_45
  RTI

IRQ_45
  +IRQ_SETUP_LO SP45_RASTER_IRQ, S5Y, 51, S5P, SP46_RASTER_IRQ, IRQ_46
  RTI

IRQ_46
  +IRQ_SETUP_HILO SP46_RASTER_IRQ, S6Y, 51, S6P, SP50_RASTER_IRQ, IRQ_50
  RTI

;IRQ_47
;  +IRQ_SETUP SP47_RASTER_IRQ, S7Y, 24, S7P, SP50_RASTER_IRQ, IRQ_50
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_50
  +IRQ_SETUP_LO SP50_RASTER_IRQ, S0Y, 54, S0P, SP51_RASTER_IRQ, IRQ_51
  RTI

IRQ_51
  +IRQ_SETUP_LO SP51_RASTER_IRQ, S1Y, 54, S1P, SP52_RASTER_IRQ, IRQ_52
  RTI

IRQ_52
  +IRQ_SETUP_LO SP52_RASTER_IRQ, S2Y, 54, S2P, SP53_RASTER_IRQ, IRQ_53
  RTI

IRQ_53
  +IRQ_SETUP_LO SP53_RASTER_IRQ, S3Y, 54, S3P, SP54_RASTER_IRQ, IRQ_54
  RTI

IRQ_54
  +IRQ_SETUP_LO SP54_RASTER_IRQ, S4Y, 54, S4P, SP55_RASTER_IRQ, IRQ_55
  RTI

IRQ_55
  +IRQ_SETUP_LO SP55_RASTER_IRQ, S5Y, 54, S5P, SP56_RASTER_IRQ, IRQ_56
  RTI

IRQ_56
  +IRQ_SETUP_HILO SP56_RASTER_IRQ, S6Y, 54, S6P, SP60_RASTER_IRQ, IRQ_60
  RTI

;IRQ_57
;  +IRQ_SETUP SP57_RASTER_IRQ, S7Y, 24, S7P, SP60_RASTER_IRQ, IRQ_60
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_60
  +IRQ_SETUP_LO SP60_RASTER_IRQ, S0Y, 48, S0P, SP61_RASTER_IRQ, IRQ_61
  RTI

IRQ_61
  +IRQ_SETUP_LO SP61_RASTER_IRQ, S1Y, 48, S1P, SP62_RASTER_IRQ, IRQ_62
  RTI

IRQ_62
  +IRQ_SETUP_LO SP62_RASTER_IRQ, S2Y, 48, S2P, SP63_RASTER_IRQ, IRQ_63
  RTI

IRQ_63
  +IRQ_SETUP_LO SP63_RASTER_IRQ, S3Y, 48, S3P, SP64_RASTER_IRQ, IRQ_64
  RTI

IRQ_64
  +IRQ_SETUP_LO SP64_RASTER_IRQ, S4Y, 48, S4P, SP65_RASTER_IRQ, IRQ_65
  RTI

IRQ_65
  +IRQ_SETUP_LO SP65_RASTER_IRQ, S5Y, 48, S5P, SP66_RASTER_IRQ, IRQ_66
  RTI

IRQ_66
  +IRQ_SETUP_HILO SP66_RASTER_IRQ, S6Y, 48, S6P, SP70_RASTER_IRQ, IRQ_70
  RTI

;IRQ_67
;  +IRQ_SETUP SP67_RASTER_IRQ, S7Y, 24, S7P, SP70_RASTER_IRQ, IRQ_70
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_70
  +IRQ_SETUP_LO SP70_RASTER_IRQ, S0Y, 51, S0P, SP71_RASTER_IRQ, IRQ_71
  RTI

IRQ_71
  +IRQ_SETUP_LO SP71_RASTER_IRQ, S1Y, 51, S1P, SP72_RASTER_IRQ, IRQ_72
  RTI

IRQ_72
  +IRQ_SETUP_LO SP72_RASTER_IRQ, S2Y, 51, S2P, SP73_RASTER_IRQ, IRQ_73
  RTI

IRQ_73
  +IRQ_SETUP_LO SP73_RASTER_IRQ, S3Y, 51, S3P, SP74_RASTER_IRQ, IRQ_74
  RTI

IRQ_74
  +IRQ_SETUP_LO SP74_RASTER_IRQ, S4Y, 51, S4P, SP75_RASTER_IRQ, IRQ_75
  RTI

IRQ_75
  +IRQ_SETUP_LO SP75_RASTER_IRQ, S5Y, 51, S5P, SP76_RASTER_IRQ, IRQ_76
  RTI

IRQ_76
  +IRQ_SETUP_HILO SP76_RASTER_IRQ, S6Y, 51, S6P, SP80_RASTER_IRQ, IRQ_80
  RTI

;IRQ_77
;  +IRQ_SETUP SP77_RASTER_IRQ, S7Y, 24, S7P, SP80_RASTER_IRQ, IRQ_80
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_80
  +IRQ_SETUP_LO SP80_RASTER_IRQ, S0Y, 54, S0P, SP81_RASTER_IRQ, IRQ_81
  RTI

IRQ_81
  +IRQ_SETUP_LO SP81_RASTER_IRQ, S1Y, 54, S1P, SP82_RASTER_IRQ, IRQ_82
  RTI

IRQ_82
  +IRQ_SETUP_LO SP82_RASTER_IRQ, S2Y, 54, S2P, SP83_RASTER_IRQ, IRQ_83
  RTI

IRQ_83
  +IRQ_SETUP_LO SP83_RASTER_IRQ, S3Y, 54, S3P, SP84_RASTER_IRQ, IRQ_84
  RTI

IRQ_84
  +IRQ_SETUP_LO SP84_RASTER_IRQ, S4Y, 54, S4P, SP85_RASTER_IRQ, IRQ_85
  RTI

IRQ_85
  +IRQ_SETUP_LO SP85_RASTER_IRQ, S5Y, 54, S5P, SP86_RASTER_IRQ, IRQ_86
  RTI

IRQ_86
  +IRQ_SETUP_HILO SP86_RASTER_IRQ, S6Y, 54, S6P, SP90_RASTER_IRQ, IRQ_90
  RTI

;IRQ_87
;  +IRQ_SETUP SP10_RASTER_IRQ, S7Y, 24, S7P, SP10_RASTER_IRQ, IRQ_10
;  DEC BDR
;  RTI

!ALIGN 255,0
IRQ_90
  +IRQ_SETUP_LO SP90_RASTER_IRQ, S0Y, 48, S0P, SP91_RASTER_IRQ, IRQ_91
  RTI

IRQ_91
  +IRQ_SETUP_LO SP91_RASTER_IRQ, S1Y, 48, S1P, SP92_RASTER_IRQ, IRQ_92
  RTI

IRQ_92
  +IRQ_SETUP_LO SP92_RASTER_IRQ, S2Y, 48, S2P, SP93_RASTER_IRQ, IRQ_93
  RTI

IRQ_93
  +IRQ_SETUP_LO SP93_RASTER_IRQ, S3Y, 48, S3P, SP94_RASTER_IRQ, IRQ_94
  RTI

IRQ_94
  +IRQ_SETUP_LO SP94_RASTER_IRQ, S4Y, 48, S4P, SP95_RASTER_IRQ, IRQ_95
  RTI

IRQ_95
  +IRQ_SETUP_LO SP95_RASTER_IRQ, S5Y, 48, S5P, SP96_RASTER_IRQ, IRQ_96
  RTI

IRQ_96
  +IRQ_SETUP_HILO SP96_RASTER_IRQ, S6Y, 48, S6P, SP00_RASTER_IRQ, IRQ_00
  RTI

;IRQ_97
;  +IRQ_SETUP SP10_RASTER_IRQ, S7Y, 24, S7P, SP10_RASTER_IRQ, IRQ_10
;  DEC BDR
;  RTI

;int_??
;    sta areg        ;3
;  lda #vpos         ;2
;  sta sprite_vpos_reg   ;4
;  lda #number       ;2
;  sta sprite_shape_reg  ;4
;    lda #raster_pos     ;2
;    sta raster_pos_reg    ;4
;  lda #<next_irq      ;2
;  stx fffe        ;4
;  lda #>next_irq      ;2
;  stx ffff        ;4
;    lda areg        ;3
;  inc $d019         ;6
;    reti          ;6

*= 19*1024
sprites
;48
!byte %11111111,%11111111,%11111111
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11000000,%00000000,%00000011
!byte %11111111,%11111111,%11111111
!byte 0
;49
!byte %11111111,%11111111,%11111111
!byte %11000000,%00000000,%00000011
!byte %11001111,%11111111,%11110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001111,%11111111,%11110011
!byte %11000000,%00000000,%00000011
!byte %11111111,%11111111,%11111111
!byte 0
;50
!byte %11111111,%11111111,%11111111
!byte %11000000,%00000000,%00000011
!byte %11001111,%11111111,%11110011
!byte %11001100,%00000000,%00110011
!byte %11001100,%11111111,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11000011,%00110011
!byte %11001100,%11111111,%00110011
!byte %11001100,%00000000,%00110011
!byte %11001111,%11111111,%11110011
!byte %11000000,%00000000,%00000011
!byte %11111111,%11111111,%11111111
!byte 0
;51
!byte %01010101,%01010101,%01010101
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01000000,%00000000,%00000001
!byte %01010101,%01010101,%01010101
!byte 0
;52
!byte %01010101,%01010101,%01010101
!byte %01000000,%00000000,%00000001
!byte %01000101,%01010101,%01010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000101,%01010101,%01010001
!byte %01000000,%00000000,%00000001
!byte %01010101,%01010101,%01010101
!byte 0
;53
!byte %01010101,%01010101,%01010101
!byte %01000000,%00000000,%00000001
!byte %01000101,%01010101,%01010001
!byte %01000100,%00000000,%00010001
!byte %01000100,%11111111,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11000011,%00010001
!byte %01000100,%11111111,%00010001
!byte %01000100,%00000000,%00010001
!byte %01000101,%01010101,%01010001
!byte %01000000,%00000000,%00000001
!byte %01010101,%01010101,%01010101
!byte 0
;54
!byte %10101010,%10101010,%10101010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10000000,%00000000,%00000010
!byte %10101010,%10101010,%10101010
!byte 0
;55
!byte %10101010,%10101010,%10101010
!byte %10000000,%00000000,%00000010
!byte %10001010,%10101010,%10100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001010,%10101010,%10100010
!byte %10000000,%00000000,%00000010
!byte %10101010,%10101010,%10101010
!byte 0
;56
!byte %10101010,%10101010,%10101010
!byte %10000000,%00000000,%00000010
!byte %10001010,%10101010,%10100010
!byte %10001000,%00000000,%00100010
!byte %10001000,%11111110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%10000110,%00100010
!byte %10001000,%11111110,%00100010
!byte %10001000,%00000000,%00100010
!byte %10001010,%10101010,%10100010
!byte %10000000,%00000000,%00000010
!byte %10101010,%10101010,%10101010
!byte 0
;57
!for I = 0 TO 20
!byte %11011101,%01110111,%11101110
!end
!byte 0
;58
!for I = 0 TO 20
!byte %10101010,%10101010,%11111111
!end
!byte 0
;59
!for I = 0 TO 20
!byte %11111111,%01010101,%01010101
!end
!byte 0
;60
!for I = 0 TO 20
!byte %10111110,%11111111,%10111110
!end
!byte 0

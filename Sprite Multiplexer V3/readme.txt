More efficiency improvements and it now uses the stack to sort.
